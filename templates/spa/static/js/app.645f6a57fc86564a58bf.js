webpackJsonp([0,2],[,,,function(t,e,n){"use strict";var o=n(1),s=n(2),a=n(22),i=n.n(a),r=n(23),c=n.n(r);o.a.use(s.a),e.a=new s.a({routes:[{path:"/note/",name:"Button",component:i.a},{path:"/note/share/",name:"Head",component:c.a}]})},function(t,e,n){"use strict";var o=n(1),s=n(2),a=n(24),i=n.n(a),r=n(25),c=n.n(r);o.a.use(s.a),e.a=new s.a({routes:[{path:"/",name:"Hello",component:i.a},{path:"/note/(.*)",name:"Note",component:c.a}]})},function(t,e,n){n(17);var o=n(0)(n(11),n(27),null,null);t.exports=o.exports},function(t,e,n){n(16);var o=n(0)(n(12),n(26),null,null);t.exports=o.exports},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"Button",data:function(){return{msg:"tornado-youdao"}},methods:{back:function(){window.location.href="/home/"},open:function(){window.location.href="#/note/share/"}},beforeMount:function(){this.msg=location.href}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"Head",data:function(){return{msg:"tornado-youdao"}},methods:{share:function(){var t=document.getElementById("shareInput"),e=t.value;t.selectionStart=0,t.selectionEnd=e},close:function(){window.location.href="#/note/"},init:function(){this.msg=location.href}},beforeMount:function(){this.init()},mounted:function(){this.share()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"hello",data:function(){return{msg:"Tornado实现微型网易云笔记"}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(13),s=n.n(o);e.default={name:"note",data:function(){return{save:{statement:"SAVE"},onlines:"1",title:"NOTITLE",note:"1.Create your note here",history:{cursor:null,note:null},ws:null}},methods:{heartbeat:function(){var t=this;this.saves(function(){setTimeout(function(){t.heartbeat(),console.log("save")},1e4)})},saves:function(t){var e=this,n=RegExp("/spa/(.*)?/#/note/"),o=location.href.match(n)[1];this.save.statement="SAVING...",fetch("http://localhost:8002/api/heartbeat/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:encodeURI("hash_id="+o+"&name="+e.title+"&sub="+e.note+"\n")}).then(function(t){return t.json()}).then(function(n){200!==n.code&&"200"!==n.code||(t(),setTimeout(function(){e.save.statement="SAVE"},1e3))})},insertAtCaret:function(t,e){var n=document.getElementById("youdao-note"),o=this;if(document.selection)console.log("ie");else if(n.selectionStart>=e){var s=n.selectionStart;n.selectionEnd;n.value=n.value.substring(0,e)+t+n.value.substring(e,n.value.length),n.selectionStart=s+t.length,n.selectionEnd=s+t.length,o.note=n.value}else{var s=n.selectionStart;n.selectionEnd;n.value=n.value.substring(0,e)+t+n.value.substring(e,n.value.length),n.selectionStart=s,n.selectionEnd=s,o.note=n.value}},cutAtCaret:function(t,e){var n=document.getElementById("youdao-note"),o=this;if(document.selection)console.log("ie");else if(n.selectionStart>=e){var s=n.selectionStart;n.selectionEnd;n.value=n.value.substring(0,e-t)+n.value.substring(e,n.value.length),n.selectionStart=s-t,n.selectionEnd=s-t,o.note=n.value}else if(n.selectionStart>=e-t&&n.selectionStart<e){var s=n.selectionStart;n.selectionEnd;n.value=n.value.substring(0,e-t)+n.value.substring(e,n.value.length),n.selectionStart=e-t,n.selectionEnd=e-t,o.note=n.value}else{var s=n.selectionStart;n.selectionEnd;n.value=n.value.substring(0,e-t)+n.value.substring(e,n.value.length),n.selectionStart=s,n.selectionEnd=s,o.note=n.value}},getCursorPos:function(){var t=0,e=document.getElementById("youdao-note");if(document.selection){var n=document.selection.createRange();e.focus(),n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t},saveLocalState:function(){this.history.cursor=this.getCursorPos(),this.history.note=this.note},sendLocalModified:function(){var t,e,n=this.getCursorPos(),o=this.note,a="";n>this.history.cursor?(a=o.substring(this.history.cursor,n),console.log("+ "+a),t="+",e=n-this.history.cursor):(a=this.history.note.substring(n,this.history.cursor),console.log("- "+a),t="-",e=this.history.cursor-n),this.ws.send(s()({type:t,range:e,pos:this.history.cursor,change:a})),this.history.cursor=this.getCursorPos(),this.history.note=this.note},fetchNote:function(){var t=this,e=RegExp("/spa/(.*)?/#/note/"),n=location.href.match(e)[1];fetch("/api/get-note/?hash_id="+n).then(function(t){return t.json()}).then(function(e){e=e.data,t.title=e.name,t.note=e.sub})},init:function(){var t,e=this,n=this,o=RegExp("/spa/(.*)?/#/note/"),a=location.href.match(o)[1],i=new WebSocket("ws://localhost:8002/api/ws/echo/"+a);i.onopen=function(){i.send(s()({type:"cookie",mycookie:document.cookie}))},i.onmessage=function(e){t=JSON.parse(e.data),"+"===t.type?n.insertAtCaret(t.change,t.pos):"-"===t.type?n.cutAtCaret(t.range,t.pos):"onlines"===t.type&&(n.onlines=t.count)},this.ws=i,this.fetchNote(),setTimeout(function(){e.heartbeat()},5e3)}},beforeMount:function(){console.log("init"),this.init()}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"vueheader"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"app"}},,,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,n){n(19);var o=n(0)(n(7),n(29),"data-v-9369f592",null);t.exports=o.exports},function(t,e,n){n(18);var o=n(0)(n(8),n(28),"data-v-3ce247b6",null);t.exports=o.exports},function(t,e,n){n(20);var o=n(0)(n(9),n(30),"data-v-b1698746",null);t.exports=o.exports},function(t,e,n){n(21);var o=n(0)(n(10),n(31),"data-v-fb633592",null);t.exports=o.exports},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("img",{attrs:{src:"http://www.bootcss.com/p/flat-ui/images/demo/logo-mask.png"}}),t._v(" "),n("router-view",{attrs:{"keep-alive":""}})],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"vueheader"}},[n("router-view",{attrs:{"keep-alive":""}})],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"root"},[n("div",{staticClass:"header-wrapper"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.msg,expression:"msg"}],staticClass:"share-input",attrs:{id:"shareInput"},domProps:{value:t.msg},on:{input:function(e){e.target.composing||(t.msg=e.target.value)}}}),t._v(" "),n("p",{staticClass:"close",on:{click:function(e){t.close()}}},[t._v("x")])])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"button-wrapper"},[n("div",{staticClass:"left green button",on:{click:function(e){t.back()}}},[t._v("Back")]),t._v(" "),n("div",{staticClass:"left green button",on:{click:function(e){t.open()}}},[t._v("共享我的笔记链接")])])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"hello"},[n("h1",[t._v(t._s(t.msg))])])},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"root"},[n("div",{staticClass:"top-line clearfix short"},[n("p",{staticClass:"online-statement"},[t._v("正在协同编辑的用户数: "+t._s(t.onlines)+"人")]),t._v(" "),n("div",{staticClass:"save-statement",on:{click:function(e){t.saves(function(){})}}},[t._v(t._s(t.save.statement))])]),t._v(" "),n("div",{staticClass:"line short"}),t._v(" "),n("div",{staticClass:"short"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"youdao-title",domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"line short"}),t._v(" "),n("div",{staticClass:"note-wrapper short"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.note,expression:"note"}],staticClass:"youdao-note",attrs:{id:"youdao-note"},domProps:{value:t.note},on:{keydown:function(e){t.saveLocalState()},input:[function(e){e.target.composing||(t.note=e.target.value)},function(e){t.sendLocalModified()}]}})])])},staticRenderFns:[]}},,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),s=n(5),a=n.n(s),i=n(3),r=n(6),c=n.n(r),u=n(4);o.a.config.productionTip=!1,new o.a({el:"#header",router:i.a,template:"<Header/>",components:{Header:a.a}}),new o.a({el:"#app",router:u.a,template:"<Note/>",components:{Note:c.a}})}],[34]);
//# sourceMappingURL=app.645f6a57fc86564a58bf.js.map